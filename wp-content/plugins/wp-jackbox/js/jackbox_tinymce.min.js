(function(e){function ba(){var a=e("#content_ifr");if(a.length)a.one("load.jackbox",ma);else ca++,25>ca&&setTimeout(ba,50)}function ma(){var a=e(this),a=a.contents();a.length&&(a=a.find("head"),a.length&&e("<style />").html("a.jackbox, a.jackbox:visited {background-color: #e5e5e5} .jackbox img {padding: 6px; margin: 0; background-color: #e5e5e5}").appendTo(a))}function na(a,b,c){a=e(c);c=c.nodeName.toLowerCase();x=b;"a"===c||"img"===c?(b.setDisabled("jackbox",!1),"img"===c&&(a=a.closest("a"))):b.setDisabled("jackbox", !0);a.attr("class")?-1!==a.attr("class").search("jackbox")?b.setDisabled("jackbox_remove",!1):b.setDisabled("jackbox_remove",!0):b.setDisabled("jackbox_remove",!0)}function oa(){s.execCommand("mceCodeEditor")}function pa(){t.execCommand("mceCodeEditor")}function qa(){B||(B=e(L).appendTo(e("body")),M=e(".jackbox-cover").click(N),f=e(M.find("form")).submit(ra),f.find("input[type=text], textarea"),da=f.find("input[type=text], input[type=radio], textarea, select"),ea=e(window),k=f.find(".jb-extras"), O=f.find(".jb-category"),C=f.find("select[name=data-jbhover]"),fa=M.find("h2")[0],q=f.find(".jb-multimedia"),D=f.find("input[name=data-jbtitle]"),f.find("textarea[name=data-jbhtml]"),r=f.find(".jb-media-holder").hide(),E=f.find(".jb-thumb-holder").hide(),F=f.find(".jb-poster-holder").hide(),L=e(".jackbox-container").click(sa),e(".jackbox-edit-raw-desc").click(pa),P=e(".jackbox-edit-raw").click(oa).hide(),u=e(".jb-inline").children("input").change(ta),n=f.find("input[name=data-jbgroup]").keyup(ua), Q=f.find("input[name=data-jbposter]").focusin(R).focusout(S),m=f.find("input[name=data-jbhref]").data("jbType",1).focusin(R).focusout(S),T=f.find("input[name=data-jbthumbnail]").data("jbType",2).focusin(R).focusout(S),ga=!!document.createElement("video").canPlayType,ha=-1===navigator.userAgent.toLowerCase().search("msie")&&!!document.createElement("video").canPlayType,j=[],e(".jackbox-addmedia").click(ia),e(".jackbox-close").click(N),e(".jackbox-small").keyup(va),U=f.find(".jackbox-scale-no"),V=f.find(".jackbox-scale-yes"), G=f.find(".jackbox-scale-default"),W=f.find(".jackbox-autoplay-no"),X=f.find(".jackbox-autoplay-yes"),H=f.find(".jackbox-autoplay-default"),Y=f.find(".jackbox-flash-no"),Z=f.find(".jackbox-flash-yes"),I=f.find(".jackbox-flash-default"),$=f.find(".jackbox-hidden-yes"),J=f.find(".jackbox-hidden-no"),tinyMCE.execCommand("mceAddControl",!1,"jb-tiny-desc"),tinyMCE.execCommand("mceAddControl",!1,"jb-tiny-html"),t=tinyMCE.getInstanceById("jb-tiny-desc"),s=tinyMCE.getInstanceById("jb-tiny-html"),e("#jb-tiny-desc_ifr").css("background-color", "#FFF"),e("#jb-tiny-desc_parent").css({display:"block",marginTop:7}).find(".mce_jackbox, .mce_jackbox_remove").remove(),v=e("#jb-tiny-html_ifr").css({backgroundColor:"#FFF",height:215}).hide(),y=e("#jb-tiny-html_parent").css({display:"block",paddingTop:7,clear:"both"}).hide(),y.find(".mce_jackbox, .mce_jackbox_remove").remove(),Array.prototype.indexOf||(Array.prototype.indexOf=wa));ja=window.send_to_editor;window.send_to_editor=xa;p=tinyMCE.getInstanceById("content");l=p.selection;x=p.controlManager; x.setDisabled("jackbox",!0);x.setDisabled("jackbox_remove",!0);var a=l.select(l.getNode()),b,c;h=e(a);h.is("img")&&(a=h.closest("a"),a.is("a")&&(h=a),c=!0);H.attr("checked","checked");G.attr("checked","checked");I.attr("checked","checked");J.attr("checked","checked");C[0].selectedIndex=0;t.setContent("");e("#wp_editbtns").hide();if(h.is("a"))if(h.hasClass("jackbox"))for(a=ka.length;a--;){if(b=ka[a],h.attr(b))a:{c=b;b=h.attr(b);var d=void 0,g=void 0;if(-1!==c.search("data-jb")){g=c.split("data-jb")[1]; switch(g){case "title":f.find("input[name="+c+"]").val(unescape(b));break a;case "description":t.setContent(unescape(b));break a;case "hover":d=f.find("select[name="+c+"]");break;case "html":u[0].checked=!0;u.trigger("change");s.setContent(unescape(b));break a;default:d=f.find("input[name="+c+"]")}if(d.length)if("radio"!==d.attr("type"))switch(g){case "thumbnail":d.val(b);w(b,E);break;case "hover":if(c=b.match(ya))C[0].selectedIndex=C.find("option[value="+c+"]").index();break;case "poster":d.val(b); w(b,F);break;case "group":d.val(unescape(b));break;default:d.val(b)}else switch(g){case "scaleup":"no"===b?(V.removeAttr("checked"),G.removeAttr("checked"),U.attr("checked","checked")):"yes"===b&&(U.removeAttr("checked"),G.removeAttr("checked"),V.attr("checked","checked"));break;case "autoplay":"no"===b?(X.removeAttr("checked"),H.removeAttr("checked"),W.attr("checked","checked")):"yes"===b&&(W.removeAttr("checked"),H.removeAttr("checked"),X.attr("checked","checked"));break;case "hiddenitem":"no"=== b?($.removeAttr("checked"),J.attr("checked","checked")):"yes"===b&&(J.removeAttr("checked"),$.attr("checked","checked"));break;case "flashhaspriority":"no"===b?(Z.removeAttr("checked"),I.removeAttr("checked"),Y.attr("checked","checked")):"yes"===b&&(Y.removeAttr("checked"),I.removeAttr("checked"),Z.attr("checked","checked"))}}else"href"===c&&(m.val(b),w(b,r))}}else{if(a=h.attr("href"))m.val(a),w(a,r);h.attr("title")&&D.val(h.attr("title"))}else c?c&&h.attr("alt")&&D.val(h.attr("alt")):(c=h.children("img"), c.length&&c.attr("alt")&&(D.val(c.attr("alt")),h=c));c=p.getContent({format:"raw"});b=(d=c.match(/data-jbgroup="/g))?d.length:0;for(a=0;a<b;a++){g=c.indexOf('data-jbgroup="');for(d=g+15;'"'!==c.charAt(d);)d++;g=c.substring(g+14,d);-1===j.indexOf(unescape(g))&&(j[j.length]=unescape(g));c=c.substr(d,c.length)}if(j.length){b=j.length;d={type:"checkbox"};for(a=0;a<b;a++)c=unescape(j[a]),d.name="jb-"+c.split(" ").join("-"),e("<input />").attr(d).change(za).appendTo(k),e("<span />").text(" "+c).appendTo(k), e("<br />").appendTo(k);k.show();O.addClass("jb-noborder");n.val()?(a=j.indexOf(n.val()),-1!==a&&k.children("input[name=jb-"+unescape(j[a]).split(" ").join("-")+"]").attr("checked","checked")):(n.val(unescape(j[0])),k.children("input[name=jb-"+unescape(j[0]).split(" ").join("-")+"]").attr("checked","checked"))}B.stop(!0,!0).fadeIn(300);L.scrollTop(0)}function za(){if(this.checked)for(var a=k.children("input"),b=a.length,c;b--;)c=e(a[b]),c[0]!==this?c.removeAttr("checked"):(c.attr("checked","checked"), c=c.next().text(),n.val(c.substring(1,c.length)));else n.val("")}function ua(){var a=j.indexOf(this.value);-1===a?k.children("input").each(Aa):k.children("input[name=jb-"+j[a].split(" ").join("-")+"]").attr("checked","checked")}function Aa(){e(this).removeAttr("checked")}function ra(a){a.preventDefault();if(window.confirm("Submit Changes?")){a=!0;z=u[0].checked;n.val()||(n.addClass("jb-error").one("focusin",aa),a=!1);if(z)s.getContent()||(v.addClass("jb-error").one("click",aa),a=!1);else{var b=m.val(); if(!b||"#"===b)m.addClass("jb-error").one("focusin",aa),a=!1}a?(g=e("<a />"),h.attr("class")&&g.attr("class",h.attr("class")),g.removeClass("jackbox-hidden-item").addClass("jackbox"),h.is("a")?g.html(h.html()):g.append(h),da.each(Ba),l.setNode(g[0]),N()):fa.scrollIntoView()}}function Ba(){var a=e(this),b=a.attr("name"),c=a.attr("type"),d=a.val(),f=b.split("data-jb")[1];if("href"===f){if(z||!d)d="#";g.attr("href",d)}else{var h="description"===f;if(h||"html"===f){if(h)d=t.getContent();else if(z)d=s.getContent(); else return;d&&g.attr(b,escape(d))}else if(d&&"checkbox"!==c)if("radio"!==c){if(!("hover"===f&&"default"===d)){if("title"===f||"group"===f)d=escape(d);g.attr(b,d)}}else if(a.attr("checked"))switch(a=a.attr("class").split("jackbox-").join(""),f){case "scaleup":"scale-yes"===a?g.attr(b,"yes"):"scale-no"===a?g.attr(b,"no"):g.removeAttr(b);break;case "autoplay":"autoplay-yes"===a?g.attr(b,"yes"):"autoplay-no"===a?g.attr(b,"no"):g.removeAttr(b);break;case "hiddenitem":"hidden-yes"===a&&(g.attr(b,"yes"), g.addClass("jackbox-hidden-item"));break;case "flashhaspriority":"flash-yes"===a?g.attr(b,"yes"):"flash-no"===a?g.attr(b,"no"):g.removeAttr(b)}}}function N(a){if(!a||window.confirm("Exit without Saving?"))B.stop(!0,!0).fadeOut(300),f.find("input[type=text], textarea").val(""),O.removeClass("jb-noborder"),j=[],z=!1,k.empty().hide(),r.empty().hide(),E.empty().hide(),F.empty().hide(),Q.removeData("jborig"),u.removeAttr("checked"),T.removeData("jborig"),n.removeClass("jb-error"),q.removeClass("jb-loading"), u.removeData("jbhasmedia"),m.removeData("jborig").removeClass("jb-error").show(),v.removeClass("jb-error").hide(),t.setContent(""),s.setContent(""),y.hide(),q.show(),window.send_to_editor=ja,ea.scrollTop(0)}function sa(a){a.stopImmediatePropagation()}function ia(){var a=e(this);!a.hasClass("jackbox-addmedia")&&a.is("img")&&(a=a.parent().parent().find(".jackbox-addmedia"));a=a.parent();a.hasClass("jb-multimedia")&&(a=a.parent());la=a.find("input[type=text]").data("jbType");tb_show("","media-upload.php?type=image&amp;TB_iframe=true")} function xa(a){var b;a=e(a);a=a.attr("src")||a.attr("href");switch(la){case 1:input=m;b=r;break;case 2:input=T;b=E;break;default:input=Q,b=F}input.val(a);w(a,b);tb_remove()}function R(){var a=e(this),b=a.val();b&&a.data("jborig",b)}function S(){var a=e(this),b=a.val();b!==a.data("jborig")&&w(b,e(this).parent().children(".jb-media"))}function w(a,b){var c=Ca(a);b.empty().hide();if(c){var d;"vimeo"!==c?-1!==c.search("mp4")?ha?(d=e("<video />").attr("controls","controls").appendTo(b.show()),e("<source />").attr({type:"video/webm", src:c.split("mp4").join("webm")}).appendTo(d),e("<source />").attr({type:"video/mp4",src:c}).appendTo(d)):(d=e("<img />").one("load.jackbox",K).appendTo(b),d.attr("src",A+"../img/video.jpg")):-1!==c.search("mp3")?ga?(d=e("<audio />").attr("controls","controls").appendTo(b.show()),e("<source />").attr({type:"audio/ogg",src:c.split("mp3").join("ogg")}).appendTo(d),e("<source />").attr({type:"audio/mpeg",src:c}).appendTo(d)):(d=e("<img />").one("load.jackbox",K).appendTo(b),d.attr("src",A+"../img/audio.jpg")): (q.addClass("jb-loading"),d=e("<img />").one("load.jackbox",K).one("error.jackbox",Da).appendTo(b),d.attr("src",c)):(d=e("<img />").one("load.jackbox",K).appendTo(b),e.getJSON("http://vimeo.com/api/v2/video/"+a.split("https").join("http").split("http://vimeo.com/")[1]+".json?callback=?",{format:"json"},function(a){d.attr("src",a[0].thumbnail_small)}))}}function Da(){q.removeClass("jb-loading");e(this).unbind("load.jackbox")}function Ca(a){if(-1!==a.search("youtube"))return"http://img.youtube.com/vi/"+ a.split("http://www.youtube.com/watch?v=")[1]+"/1.jpg";if(-1!==a.search("vimeo"))return"vimeo";var b=a.split(".");if(!b.length)return null;b=b[b.length-1];return"jpg"===b||"png"===b||"gif"===b||"mp4"===b||"mp3"===b?a:null}function K(){var a=e(this).unbind("error.jackbox");q.removeClass("jb-loading");a.parent().show();var b=this.width||a.width(),c=this.height||a.height(),d=75<c?75/c:1;223<b*d&&(d=223/b);a.attr({width:b*d,height:c*d}).click(ia)}function ta(){var a=e(this);this.checked?(""!==r.html()&& (a.data("jbhasmedia",!0),r.hide()),q.hide(),m.hide(),y.show(),v.show(),P.show()):(v.hide(),y.hide(),P.hide(),q.show(),m.show(),a.data("jbhasmedia")&&(a.removeData("jbhasmedia"),r.show()));m.removeClass("jb-error");v.removeClass("jb-error")}function wa(a){for(var b=this.length;b--;)if(this[b]===a)return b;return-1}function va(){this.value=this.value.replace(Ea,"")}function aa(){e(this).removeClass("jb-error")}function Fa(){l=e(p.selection.getNode());l.is("img")&&(l=l.parent());l.removeClass("jackbox jackbox-hidden-item"); x.setDisabled("jackbox_remove",!0);for(var a=l[0].attributes,b=a.length,c;b--;)c=a[b].name,-1!==c.search("data-jb")&&l.removeAttr(c)}var g,ea,j,h,ja,A,f,C,M,B,m,q,D,k,p,da,Q,W,fa,u,n,la,Y,U,X,H,x,ga,ha,P,O,V,G,Z,I,y,s,t,J,$,z,l,T,v,r,E,F,ca=0,Ea=/[^0-9\.|#|-]/g,ya=/none|black-magnify|black-play|black-document|white-magnify|white-play|white-document|blur-magnify|blur-play|blur-document/g,ka="href data-jbgroup data-jbhref data-jbtitle data-jbdescription data-jbwidth data-jbheight data-jbthumbnail data-jbthumbtooltip data-jbhover data-jbscaleup data-jbautoplay data-jbflashhaspriority data-jbposter data-jbaudiotitle data-jbhiddenitem data-jbhtml".split(" "), L='<div class="jackbox-modal"><div class="jackbox-cover"><div class="jackbox-container"><span class="jackbox-close button">x</span><div class="jackbox-content"><h2>'+jackboxTranslate.jb_1+'</h2><hr /><form class="jackbox-form" method="post" enctype="text/plain"><h3>'+jackboxTranslate.jb_2+'</h3><p class="jb-category">'+jackboxTranslate.jb_3+' <span class="jackbox-question" data-title="'+jackboxTranslate.jb_4+'">?</span><br /><input class="jackbox-medium" name="data-jbgroup" type="text" /></p><p class="jb-extras"></p><hr /><p><span class="jb-multimedia">'+ jackboxTranslate.jb_5+' <img class="jackbox-addmedia" src="'+jackboxTranslate.jb_btn+'" /> <span class="jackbox-question" data-title="'+jackboxTranslate.jb_6+'">?</span></span><span class="jackbox-edit-raw button">'+jackboxTranslate.jb_47+'</span><span class="jb-inline">'+jackboxTranslate.jb_7+'<span class="jackbox-question jb-q1" data-title="'+jackboxTranslate.jb_8+'">?</span><input type="checkbox" name="data-jbcontent" /></span><input name="data-jbhref" type="text" /><textarea id="jb-tiny-html" name="data-jbhtml"></textarea><span class="jb-media jb-media-holder"></span></p><hr /><h3>'+ jackboxTranslate.jb_9+"</h3><p>"+jackboxTranslate.jb_10+' <span class="jackbox-question" data-title="'+jackboxTranslate.jb_11+'">?</span><br /><input class="jackbox-medium" name="data-jbtitle" type="text" /></p><hr /><p><span class="jackbox-edit-raw-desc button">'+jackboxTranslate.jb_47+"</span>"+jackboxTranslate.jb_12+' <span class="jackbox-question" data-title="'+jackboxTranslate.jb_13+'">?</span><br /><textarea id="jb-tiny-desc" name="data-jbdescription"></textarea></p><hr /><div><p>'+jackboxTranslate.jb_14+ ' <span class="jackbox-question" data-title="'+jackboxTranslate.jb_15+'">?</span><br /><input class="jackbox-small" name="data-jbwidth" type="text" /></p><p>'+jackboxTranslate.jb_16+' <span class="jackbox-question" data-title="'+jackboxTranslate.jb_17+'">?</span><br /><input class="jackbox-small" name="data-jbheight" type="text" /></p></div><hr /><p>'+jackboxTranslate.jb_18+' <span class="jackbox-question" data-title="'+jackboxTranslate.jb_19+'">?</span><br /><span class="jackbox-box"><input class="jackbox-scale-yes" name="data-jbscaleup" type="radio" value="true" /> '+ jackboxTranslate.jb_yes+' <input class="jackbox-scale-no" name="data-jbscaleup" type="radio" value="false" /> '+jackboxTranslate.jb_no+' <input class="jackbox-scale-default" name="data-jbscaleup" type="radio" value="default" /> '+jackboxTranslate.jb_default+"</span></p><hr /><p>"+jackboxTranslate.jb_20+' <span class="jackbox-question" data-title="'+jackboxTranslate.jb_21+'">?</span><br /><select name="data-jbhover"><option value="default" selected>'+jackboxTranslate.jb_default+'</option><option value="none">'+ jackboxTranslate.jb_22+'</option><option value="black-magnify">'+jackboxTranslate.jb_23+'</option><option value="black-play">'+jackboxTranslate.jb_24+'</option><option value="black-document">'+jackboxTranslate.jb_25+'</option><option value="white-magnify">'+jackboxTranslate.jb_26+'</option><option value="white-play">'+jackboxTranslate.jb_27+'</option><option value="white-document">'+jackboxTranslate.jb_28+'</option><option value="blur-magnify">'+jackboxTranslate.jb_29+'</option><option value="blur-play">'+ jackboxTranslate.jb_30+'</option><option value="blur-document">'+jackboxTranslate.jb_31+"</option></select></p><hr /><p>"+jackboxTranslate.jb_32+' <img class="jackbox-addmedia" src="'+jackboxTranslate.jb_btn+'" /> <span class="jackbox-question" data-title="'+jackboxTranslate.jb_33+'">?</span><br /><input name="data-jbthumbnail" type="text" /><br /><span class="jb-media jb-thumb-holder"></span></p><hr /><p>'+jackboxTranslate.jb_34+' <span class="jackbox-question" data-title="'+jackboxTranslate.jb_35+ '">?</span><br /><input class="jackbox-medium" name="data-jbthumbtooltip" type="text" /></p><hr /><div><p>'+jackboxTranslate.jb_36+' <span class="jackbox-question" data-title="'+jackboxTranslate.jb_37+'">?</span><br /><span class="jackbox-box"><input class="jackbox-autoplay-yes" name="data-jbautoplay" type="radio" value="true" /> '+jackboxTranslate.jb_yes+' <input class="jackbox-autoplay-no" name="data-jbautoplay" type="radio" value="false" /> '+jackboxTranslate.jb_no+' <input class="jackbox-autoplay-default" name="data-jbautoplay" type="radio" value="default" /> '+ jackboxTranslate.jb_default+"</span></p><p>"+jackboxTranslate.jb_38+' <span class="jackbox-question jb-q1" data-title="'+jackboxTranslate.jb_39+'">?</span><br /><span class="jackbox-box"><input class="jackbox-flash-yes" name="data-jbflashhaspriority" type="radio" value="false" /> '+jackboxTranslate.jb_yes+' <input class="jackbox-flash-no" name="data-jbflashhaspriority" type="radio" value="true" /> '+jackboxTranslate.jb_no+' <input class="jackbox-flash-default" name="data-jbflashhaspriority" type="radio" value="default" /> '+ jackboxTranslate.jb_default+"</p></div><hr /><p>"+jackboxTranslate.jb_40+' <img class="jackbox-addmedia" src="'+jackboxTranslate.jb_btn+'" /> <span class="jackbox-question" data-title="'+jackboxTranslate.jb_41+'">?</span><br /><input name="data-jbposter" type="text" /><br /><span class="jb-media jb-poster-holder"></span></p><hr /><p>'+jackboxTranslate.jb_42+' <span class="jackbox-question" data-title="'+jackboxTranslate.jb_43+'">?</span><br /><input class="jackbox-medium" name="data-jbaudiotitle" type="text" /></p><hr /><p>'+ jackboxTranslate.jb_44+' <span class="jackbox-question" data-title="'+jackboxTranslate.jb_45+'">?</span><br /><span class="jackbox-box"><input class="jackbox-hidden-yes" name="data-jbhiddenitem" type="radio" value="false" /> '+jackboxTranslate.jb_yes+' <input class="jackbox-hidden-no" name="data-jbhiddenitem" type="radio" value="true" /> '+jackboxTranslate.jb_no+'</span></p><hr /><p class="submit_jb"><input type="submit" class="button-primary" value="'+jackboxTranslate.jb_46+'" /></p></form></div></div></div></div>'; tinymce.create("tinymce.plugins.jackbox",{init:function(a,b){p=a;A=b+"/";p.addButton("jackbox",{title:"Add/Edit JackBox",image:A+"../img/jackbox.png",onclick:qa});p.addButton("jackbox_remove",{title:"Remove JackBox",image:A+"../img/jackbox_remove.png",onclick:Fa});ba();p.onNodeChange.add(na)}});tinymce.PluginManager.add("jackbox",tinymce.plugins.jackbox)})(jQuery);